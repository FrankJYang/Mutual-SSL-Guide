##  SSL-Guide

Basic Tutorial that teaches you how to set up a secure SSL with Liberty

### Step I: set up a basic liberty server
#### Please refer to the [IBM Cloud HelloWorld](https://github.com/IBM-Cloud/java-helloworld) for a more comprehensive set-up

We utilize Apache Maven to build this project. Please refer to the [Maven Website](https://maven.apache.org/) for instructions on how to install Apache Maven.

1.  Clone from the follow repositorary: https://github.com/IBM-Cloud/java-helloworld.git
2.  Move into the java-helloworld folder, then issue the command mvn clean install to create the /target/JavaHelloWorldApp.war file
3.  You should see the following output:
’’’
[INFO] Packaging webapp
[INFO] Assembling webapp [JavaHelloWorldApp] in [/[Insert-Directory]/java-helloworld/target/JavaHelloWorldApp-1.0-SNAPSHOT]
[INFO] Processing war project
[INFO] Copying webapp resources [/[Insert-Directory]/java-helloworld/src/main/webapp]
[INFO] Webapp assembled in [24 msecs]
[INFO] Building war: /[Insert-Directory]/java-helloworld/target/JavaHelloWorldApp.war
’’’
4.  while you are in the java-helloworld folder, run mvn liberty:run-server to start up the server 
    *Make sure you do not have a running application using Port:9080*
    consider using *sudo lsof -i -P -n* to check the ports that are being used. The port number is the number after the IP          address. For instance, you might see 10.86.128.138:22, where 10.86.128.138 is the IP address and it is using port 22.
5.  You should see the following output:
’’’
  [INFO]  The server defaultServer has been launched.
  [INFO]  Monitoring dropins for applications.
  [INFO]  Web application available (default_host): http://YourLocalAddress:9080/JavaHelloWorldApp/
  [INFO]  Application JavaHelloWorldApp started in X seconds.
  [INFO]  The server installed the following features: [servlet-3.1].
  [INFO]  The server defaultServer is ready to run a smarter planet.
’’’
6.  Check out your default server using the *http://[InsertLocalAddress]:9080/JavaHelloWorldApp/* from Web application available (default_host)
    
### Step II: modify the finished product
Move into the "finish" folder, which contains the working example. Take a look at the following key points that enabled the mutual SSL. 

1.    under *finish/src/main/java/io/openliberty/guides/hello/HelloServlet.java*  

(Servlet security annotation under @servletSecurity @HttpConstraint)  
Specify the path as javax.servlet.annotation.ServletSecurity.TransportGuarantee.CONFIDENTIAL. This enable the transfer from http to a secured endpoint (https).
    
2.    under *finish/target/liberty/wlp/usr/servers/defaultServer/bootstrap.properties* 

modify the default https path here
    
3.    under *finish/src/main/liberty/config/server.xml*  <br/>

make a keystore, ie. <keyStore id="defaultKeyStore" password="temppass1" />

### Step III: generating the keyFile

    how it works: The client(browser/website) wants to access Liberty. key.jks is a self-signed SSL certificate. When the client visits Liberty, it checks its certificate with list of trusted CAs. In this case, since the cerificate was self-signed, we need to add a browser exception saying that we trust this entity.

    under *finish/target/liberty/wlp/usr/servers/defaultServer/resources* is where we store the key files.
    
1. create CA.cert

    
    openssl genrsa -des3 -out ca.key 4096
    openssl req -new -x509 -days 365 -key ca.key -out ca.crt
    
    
2.  create client key and CSR

    
    openssl genrsa -des3 -out client.key 4096
    openssl req -new -key client.key -out client.csr
    self-signed
    openssl x509 -req -days 365 -in client.csr -CA ca.crt -CAkey ca.key -set_serial 01 -out client.crt
    
    
3.  convert client key to PKCS

    
    openssl pkcs12 -export -clcerts -in client.crt -inkey client.key -out client.p12
    
    
4.  Overview:
key.jks was generated by Liberty. we generated frank.crt and client.crt. frank.p12 was given. 
5.  merge the frank.p12 (CA signed) to key.jks 
